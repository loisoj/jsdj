var audio=new AudioContext,data={step:0,tracks:[createTrack("gold",note(audio,880)),createTrack("gold",note(audio,659)),createTrack("gold",note(audio,587)),createTrack("gold",note(audio,523)),createTrack("gold",note(audio,440)),createTrack("dodgerblue",kick(audio))]};setInterval(function(){data.step=(data.step+1)%data.tracks[0].steps.length,data.tracks.filter(function(t){return t.steps[data.step]}).forEach(function(t){t.playSound()})},100);var screen=document.getElementById("screen").getContext("2d");function note(e,n){return function(){var t=createSineWave(e,1);t.frequency.value=n,chain([t,createAmplifier(e,.2,1),e.destination])}}function kick(e){return function(){var t=createSineWave(e,2);rampDown(e,t.frequency,160,2),chain([t,createAmplifier(e,.4,2),e.destination])}}function createSineWave(t,e){var n=t.createOscillator();return n.type="sine",n.start(t.currentTime),n.stop(t.currentTime+e),n}function rampDown(t,e,n,a){e.setValueAtTime(n,t.currentTime),e.exponentialRampToValueAtTime(.01,t.currentTime+a)}function createAmplifier(t,e,n){var a=t.createGain();return rampDown(t,a.gain,e,n),a}function chain(t){for(var e=0;e<t.length-1;e++)t[e].connect(t[e+1])}function createTrack(t,e){for(var n=[],a=0;a<16;a++)n.push(!1);return{steps:n,color:t,playSound:e}}!function t(){screen.clearRect(0,0,screen.canvas.width,screen.canvas.height),drawTracks(screen,data),drawButton(screen,data.step,data.tracks.length,"deeppink"),requestAnimationFrame(t)}(),document.getElementById("screen").addEventListener("click",function(t){var r={x:t.offsetX,y:t.offsetY};data.tracks.forEach(function(n,a){n.steps.forEach(function(t,e){isPointInButton(r,e,a)&&(n.steps[e]=!t)})})});var BUTTON_SIZE=26;function buttonPosition(t,e){return{x:BUTTON_SIZE/2+t*BUTTON_SIZE*1.5,y:BUTTON_SIZE/2+e*BUTTON_SIZE*1.5}}function drawButton(t,e,n,a){var r=buttonPosition(e,n);t.fillStyle=a,t.fillRect(r.x,r.y,BUTTON_SIZE,BUTTON_SIZE)}function drawTracks(r,t){t.tracks.forEach(function(n,a){n.steps.forEach(function(t,e){drawButton(r,e,a,t?n.color:"lightgray")})})}function isPointInButton(t,e,n){var a=buttonPosition(e,n);return!(t.x<a.x||t.y<a.y||t.x>a.x+BUTTON_SIZE||t.y>a.y+BUTTON_SIZE)}
